# Mizuchi Uploadr Configuration
# Copy this file to config.yaml and modify as needed

server:
  address: "0.0.0.0:8080"
  zero_copy:
    enabled: true
    pipe_buffer_size: 1048576  # 1MB

buckets:
  # Public uploads (no auth required)
  - name: "public-uploads"
    path_prefix: "/public"
    s3:
      bucket: "my-public-bucket"
      region: "us-east-1"
      # endpoint: "http://localhost:9000"  # For MinIO
      access_key: "${AWS_ACCESS_KEY}"
      secret_key: "${AWS_SECRET_KEY}"
    auth:
      enabled: false
    upload:
      multipart_threshold: 52428800  # 50MB
      part_size: 104857600           # 100MB
      concurrent_parts: 4

  # Private uploads (JWT auth required)
  - name: "private-uploads"
    path_prefix: "/private"
    s3:
      bucket: "my-private-bucket"
      region: "us-east-1"
      access_key: "${AWS_ACCESS_KEY}"
      secret_key: "${AWS_SECRET_KEY}"
    auth:
      enabled: true
      jwt:
        secret: "${JWT_SECRET}"
        algorithm: "HS256"
        token_sources:
          - type: "bearer"
          - type: "query"
            name: "token"
    upload:
      multipart_threshold: 52428800
      part_size: 104857600
      concurrent_parts: 4

metrics:
  enabled: true
  port: 9090

# OpenTelemetry Distributed Tracing
# Uncomment and configure to enable tracing
# tracing:
#   enabled: true
#   service_name: "${SERVICE_NAME:-mizuchi-uploadr}"
#
#   # OTLP Exporter Configuration
#   otlp:
#     endpoint: "${OTLP_ENDPOINT:-http://localhost:4317}"
#     protocol: "grpc"  # or "http/protobuf"
#     timeout_seconds: 10
#     compression: "gzip"  # Optional: "gzip" or omit for none
#
#   # Sampling Strategy
#   sampling:
#     strategy: "always"  # Options: always, never, ratio, parent_based
#     ratio: 1.0          # Only used with "ratio" strategy (0.0 to 1.0)
#
#   # Batch Span Processor
#   batch:
#     max_queue_size: 2048
#     scheduled_delay_millis: 5000  # Export every 5 seconds
#     max_export_batch_size: 512
#
# Example: Production setup with Jaeger
# tracing:
#   enabled: true
#   service_name: "mizuchi-uploadr-prod"
#   otlp:
#     endpoint: "http://jaeger:4317"
#     protocol: "grpc"
#   sampling:
#     strategy: "ratio"
#     ratio: 0.1  # Sample 10% of traces
#
# Example: Development setup with Grafana Tempo
# tracing:
#   enabled: true
#   service_name: "mizuchi-uploadr-dev"
#   otlp:
#     endpoint: "http://tempo:4317"
#     protocol: "grpc"
#   sampling:
#     strategy: "always"  # Sample all traces in dev
